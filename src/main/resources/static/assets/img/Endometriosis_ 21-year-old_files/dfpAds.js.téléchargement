AdsPlugin=function(){function B(){P("ad-request"),Ce=!1,u.style.display="block",yt(),O(c),a.datastore.set({name:"adsPlaying",data:!0});var e=new google.ima.AdsRequest;e.adTagUrl=te,e.linearAdSlotWidth=g.clientWidth,e.linearAdSlotHeight=g.clientHeight,e.nonLinearAdSlotWidth=g.clientWidth,e.nonLinearAdSlotHeight=g.clientHeight,e.omidAccessModeRules={},e.omidAccessModeRules[google.ima.OmidAccessMode.FULL]=[new RegExp("^doubleverify\\.com/.*$"),new RegExp("^Integralads\\.com/.*$"),new RegExp("^adsafeprotected\\.com/.*$"),new RegExp("^moat\\.com/.*$")],ye.requestAds(e),a.dispatchEvent({type:_,id:Oe}),Me=!0}function U(e){P("ad-manager-loaded"),a.dispatchEvent({type:_,id:xe});var t=new google.ima.AdsRenderingSettings;t.disableUi=!0,t.uiElements=[],t.restoreCustomPlaybackStateOnAdBreakComplete=!0,t.useStyledLinearAds=!0,(b=e.getAdsManager(de,t)).addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,ut),b.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,ct),b.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,pt),b.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,gt),b.addEventListener(google.ima.AdEvent.Type.LOADED,ot),b.addEventListener(google.ima.AdEvent.Type.COMPLETE,rt),b.addEventListener(google.ima.AdEvent.Type.STARTED,dt),b.addEventListener(google.ima.AdEvent.Type.CLICK,mt),b.addEventListener(google.ima.AdEvent.Type.DURATION_CHANGE,st),b.addEventListener(google.ima.AdEvent.Type.IMPRESSION,lt),b.addEventListener(google.ima.AdEvent.Type.LOG,at),b.addEventListener(google.ima.AdEvent.Type.PAUSED,nt),b.addEventListener(google.ima.AdEvent.Type.RESUMED,it),b.addEventListener(google.ima.AdEvent.Type.FIRST_QUARTILE,tt),b.addEventListener(google.ima.AdEvent.Type.MIDPOINT,tt),b.addEventListener(google.ima.AdEvent.Type.THIRD_QUARTILE,tt),b.addEventListener(google.ima.AdEvent.Type.COMPLETE,tt),De&&Ke()}function n(e,t,n){return(e=document.createElement(e)).id=t,n.appendChild(e),e}function H(e,t,n,i,a,o,s){var d=document.createElement("button");return d.id=e,d.className=t,d.title=n,(e=document.createElement("span")).className="ads_hiddenElement",e.innerHTML=n,e.setAttribute("aria-hidden","true"),d.appendChild(e),(t=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttribute("width",i),t.setAttribute("height",a),t.setAttribute("viewBox",o),(n=document.createElementNS("http://www.w3.org/2000/svg","use")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+s),t.appendChild(n),d.appendChild(t),d}function F(){P("ad-create-ux"),r=n("div","ads_adsUX",a.container),i(r,"mouseenter focus",$),i(r,"mouseleave blur",q),g=n("div","ads_adContainer",r),(u=n("div","ads_customUI",r)).style.display="none",(c=document.createElement("div")).id="ads_spinner",c.style.width="62px",c.style.height="62px",c.style.marginLeft="-31px",c.style.marginTop="-31px",c.style.top="50%",c.style.left="50%",c.style.display="none",t=document.createElement("canvas"),(e=new Sonic(t)).width=50,e.height=50,e.colour=ie,e.thickness=10,e.draw(),c.appendChild(t),u.appendChild(c),(L=n("div","ads_controlsContainer",u)).className="fadedOut",pe=n("div","ads_bottomFade",L),me=n("div","ads_bottomMiniFade",L),T=n("div","ads_clickDiv",u),i(T,"touchend click mouseup",Q),x(T),re=n("div","ads_seekBar",L),(ue=n("div","ads_progressBar",re)).style.backgroundColor=ie;var e=n("div","ads_buttonBar",L),t=(p=H("ads_playPauseButton","ads_pauseButton","Pause","31","31","0 0 44 44","pause"),i(p,"touchend click mouseup",bt),i(p,"mouseenter focus",V),i(p,"mouseleave blur",W),e.appendChild(p),m=H("ads_volumeButton","ads_audioButton","Mute","44","44","0 0 44 44","audio"),i(m,"touchend click mouseup",Y),i(m,"mouseenter focus",V),i(m,"mouseleave blur",W),e.appendChild(m),E=H("ads_fullScreenButton","ads_enterFullScreenButton","Enter Full Screen","44","44","0 0 44 44","fullscreen-enter"),i(E,"touchend click mouseup",Z),i(E,"mouseenter focus",V),i(E,"mouseleave blur",W),e.appendChild(E),f=n("div","ads_skipContainer",u),v=n("button","ads_skipButton",f),n("div","ads_skipButtonText",v).innerHTML+="Skip Ad",n("div","ads_skipButtonIcon",v),i(v,"touchend click mouseup",z),i(v,"mouseenter focus",j),i(v,"mouseleave blur",G),A=n("div","",f),(ge=n("div","ads_skipText",A)).innerHTML+="Skip ad in ",Ae&&(h=n("div","ads_learnmore",u),i(h,"touchend click mouseup",K),h.innerHTML+="Learn More",x(h)),y=n("div","ads_countdownText",u),x(y),n("span","",y));I=a.settings.ui.locale.lang;e=He[I=(e={"en-GB":"en","en-gb":"en","cy-GB":"cy","cy-gb":"cy","gd-GB":"gd","gd-gb":"gd","ga-GB":"ga","ga-gb":"ga","ru-uk":"ru",zh:"zh-hans"})[I]?e[I]:I]||He.en;t.innerHTML=e+" ",(ce=n("span","",y)).innerHTML="0:00",P("ad-create-ux-complete")}function i(e,t,n,i){for(var a="object"==typeof t?t:t.split(/\s+/g),o=0;o<a.length;o++)e.addEventListener(a[o],n,i)}function V(e){this.style.backgroundColor=ie,this.style.fill=ae}function W(e){this.style.backgroundColor="",this.style.fill=""}function j(e){this.style.border="1px solid rgba(255,255,255,1)",this.style.borderRight="0"}function G(e){this.style.border="1px solid rgba(255,255,255,0.5)",this.style.borderRight="0"}function z(e){e.stopPropagation(),M<=0&&b.skip()}function Q(e){C||(C=!0,t=setTimeout(function(){C=!1},500),Ae?("fadedOut"===L.className?Lt:Tt)():(N||bt(),b.clicked()))}function $(e){!Ae&&k&&Lt()}function q(e){!Ae&&k&&Tt()}function K(e){C||(C=!0,t=setTimeout(function(){C=!1},500),b.clicked())}function Y(){C||(C=!0,t=setTimeout(function(){C=!1},500),Se?(D(m,"ads_muteButton","Mute","44","44","0 0 44 44","audio"),b.setVolume(1)):(D(m,"ads_unmuteButton","UnMute","44","44","0 0 44 44","mute"),b.setVolume(0)),Se=!Se)}function Z(){C||(C=!0,t=setTimeout(function(){C=!1},500),a.toggleFullscreen())}function X(){J(),P("ad-sdk-loaded"),google.ima.settings.setFeatureFlags({enableOmidBeta:!0}),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(I),de=a.requestVideoElement(!0),Ee=window.Device&&Device.iPhoneOutOfPagePlayback?new google.ima.AdDisplayContainer(g):(google.ima.settings.setDisableCustomPlaybackForIOS10Plus(!0),new google.ima.AdDisplayContainer(g,de)),(ye=new google.ima.AdsLoader(Ee)).addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,U),ye.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,pt),a.listenerObject={playlistLoading:Ge,playlistLoaded:Qe,userPlay:$e,playing:qe,ended:Ye,resize:Ze,fullscreenEnter:We,fullscreenExit:je,error:ze,"bbc.smp.plugins.ads.event.updateAdTag":Je,"bbc.smp.plugins.preview.complete":Ve,pluginLoaded:Fe};var e=a.playlist;e&&Qe({playlist:e}),a.addContextMenuItem("AdsPluginHTML","AdsPluginHTML.5.7.0")}function J(){clearTimeout(oe),a.updateUiConfig({cta:{enabled:!0}})}function ee(){for(var e=0;e<Le.length;e++)"PreviewPluginHTML"===Le[e].id&&(ke=!0)}var a,te,ne,ie,ae,oe,t,se,de,le,o,s,d,l,r,u,c,g,re,ue,p,m,E,y,ce,v,f,A,ge,h,pe,me,L,T,Ee,ye,b,e=/windows phone/i.test(navigator.userAgent),ve=/iPhone/i.test(navigator.userAgent)&&!e,fe=/iPod/i.test(navigator.userAgent)&&!e,Ae=!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i)),he=!1,Le=[],I="en",M=Number.POSITIVE_INFINITY,Te=function(){},S=!1,be=!1,Ie=!1,Me=!1,N=!1,Se=!1,Ne=!1,we=!1,w=!1,Ce=!0,C=!1,ke=!1,_e=!1,Pe=!1,Re=!1,k=!1,De=!1,_="adsPlugin",Oe="adRequest",xe="adManagerLoaded",Be="adError",Ue="adDuration",He={en:"ADVERTISEMENT",pl:"REKLAMA",da:"REKLAME",nl:"ADVERTENTIE",fi:"MAINOS",fr:"RÉCLAME",de:"ANKÜNDIGUNG",id:"ADPERTENSI",it:"INSERZIONE",ja:"広告",nn:"ANNONSE",pt:"PROPAGANDA",es:"RECLAMO",sw:"TANGAZO",sv:"REKLAM"},P=function(e){window.performance&&performance.mark&&performance.mark(e)},Fe=function(e){-1===e.url.indexOf("dfpAds")&&(Le=a.datastore.get("plugins").slice()),ee()},Ve=function(e){(_e=!0)!==le.hasAds&&!0!==he||(S=!0,et())},We=function(e){w=!0,D(E,"ads_exitFullScreenButton","Exit Full Screen","22","22","0 0 32 32","fullscreen-return"),se=setTimeout(Xe,510)},je=function(e){w=!1,D(E,"ads_enterFullScreenButton","Enter Full Screen","44","44","0 0 44 44","fullscreen-enter"),se=setTimeout(Xe,510)},Ge=function(e){R(!0),le=null,C=Re=Pe=_e=we=Ne=Se=N=Me=Ie=be=S=!1,M=Number.POSITIVE_INFINITY,k=!1,clearInterval(s),clearInterval(d),clearInterval(t)},ze=function(e){"critical"==e.severity&&Ge()},Qe=function(e){le||!0!==(le=e.playlist).hasAds&&!0!==he||(S=!0,et())},$e=function(e){!0===S&&!1===Me&&(P("ad-container-init"),Ee.initialize(),B())},qe=function(e){De=!0,S&&(Me?!Ie&&b&&Ke():(Ee.initialize(),B()))},Ke=function(){Ie=!0;try{b.init(g.clientWidth,g.clientHeight,google.ima.ViewMode.NORMAL),b.start()}catch(e){R()}},Ye=function(e){(we=!0)===S&&!1===Ne?(Ce=!1,yt(),O(c),ye.contentComplete()):(ve||fe)&&de.webkitExitFullScreen()},Ze=function(e){Xe()},Xe=function(){b&&(l&&0==l.isUiDisabled()?(b.resize(g.clientWidth-(ve?66:131),g.clientHeight-(ve?48:74),w?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),g.style.left="66px",g.style.top="27px"):(b.resize(g.clientWidth,g.clientHeight,w?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),g.style.left="0px",g.style.top="0px"))},Je=function(e){te=e.data.adTag},et=function(){ke&&!_e||(a.pauseAt([0]),be)||(be=!0,Te())},tt=function(e){a.dispatchEvent({type:_,id:"adProgress",progress:e.type})},nt=function(e){D(p,"ads_playButton","Play","31","31","0 0 44 44","play"),clearInterval(s),clearInterval(d),N=!0},it=function(e){!0===N&&(D(p,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),s=setInterval(At,250),l.isSkippable&&0<M&&k&&(d=setInterval(ft,250)),N=!1)},at=function(e){var e=e.getAdData();e&&e.adError&&("1009"===(e=e.adError).getErrorCode()&&P("ad-empty"),a.dispatchEvent({type:_,id:Be,code:e.getErrorCode(),msg:e.getMessage()}))},ot=function(e){P("ad-loaded");var t=e.getAd(),t=(o=parseInt(t.getDuration()),a.dispatchEvent({type:_,id:Ue,duration:o}),e.getAdData()),e={adId:t.adWrapperIds[0]||t.adId||"NULL",adQueryId:t.adQueryId,adSystem:t.adSystem,creativeId:t.adWrapperCreativeIds[0]||t.creativeId||"NULL",duration:t.duration,mediaUrl:t.mediaUrl,title:t.title};a.dispatchEvent({type:_,id:"adData",info:e})},st=function(e){0<e.getAd().getDuration()&&(o=parseInt(e.getAd().getDuration()),a.dispatchEvent({type:_,id:Ue,duration:o}))},dt=function(e){P("ad-started"),(!0===(l=e.getAd()).isUiDisabled()?(k=!0,O(T),L.style.bottom="",L.style.setProperty("height","calc(100% - 16px)"),Ae&&O(h),b.resize(g.clientWidth,g.clientHeight,w?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),g.style.left="0px",g.style.top="0px",O):(k=!1,L.style.height="100%",x(h),x(T),b.resize(g.clientWidth-131,g.clientHeight-74,w?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),g.style.left="66px",Lt(),g.style.top="27px",x))(re),O(y),L&&(L.style.display="block",pe.style.display="block",me.style.display="block");k||(x(pe),x(me)),Re=!1,a.dispatchEvent({type:_,id:"adStarted"}),x(c),-1==p.className.indexOf("ads_pauseButton")&&D(p,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),At(),s=setInterval(At,250),l.isSkippable()&&k?(f.style.display="block",A.style.display="block",v.style.display="none",d=setInterval(ft,250)):(f.style.display="none",A.style.display="none",v.style.display="none")},lt=function(e){a.dispatchEvent({type:_,id:"adImpression"})},rt=function(e){P("ad-complete"),a.datastore.set({name:"adsPlaying",data:!1}),a.dispatchEvent({type:_,id:"adEnded"}),R()},ut=function(e){Re||R()},ct=function(){!1===a.paused&&a.pause()},gt=function(e){P("ad-all-complete"),Re||(Ce||R(),b&&(P("ad-manager-destroy"),b.destroy()),Ne=!0,a.datastore.set({name:"adsPlaying",data:!1}),a.dispatchEvent({type:"bbc.smp.plugins.ads.event.AdsPluginExternalEvent.ALL_ADS_COMPLETED"}))},pt=function(e){P("ad-error");var e=e.getError(),t=e.getErrorCode(),n=e.getInnerError(),i=0;n&&n.getErrorCode&&(i=n.getErrorCode()),a.dispatchEvent({type:_,id:Be,code:e.getErrorCode(),msg:e.getMessage()}),(t===google.ima.AdError.ErrorCode.AUTOPLAY_DISALLOWED||i===google.ima.AdError.ErrorCode.AUTOPLAY_DISALLOWED?(Re=!0,R(),a.stop(),Me=!(S=!0),et):(R(),gt))()},R=function(e){Ce||(x(c),Tt(),vt(),Et(),x(y),clearInterval(s),clearInterval(d),a.pauseAt([]),e?b&&(P("ad-manager-destroy2"),b.destroy()):we||a.play(!0),Ce=!0)},mt=function(){a.dispatchEvent({type:_,id:"adClick"}),N||bt()},D=function(e,t,n,i,a,o,s){e.className=t,e.title=n;t=e.getElementsByClassName("ads_hiddenElement")[0],t&&(t.innerHTML=n),t=e.getElementsByTagName("svg")[0],t.setAttribute("width",i),t.setAttribute("height",a),t.setAttribute("viewBox",o),n=e.getElementsByTagName("use")[0];n&&n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+s)},Et=function(){r&&(r.style.display="none",u.style.display="none"),a.updateUiConfig({controls:{enabled:!0},cta:{enabled:!0}})},yt=function(){a.updateUiConfig({controls:{enabled:!1},cta:{enabled:!1}}),r&&(r.style.display="block",Xe())},O=function(e){e&&(e.style.display="block")},x=function(e){e&&(e.style.display="none")},vt=function(){L&&(L.style.display="none",pe.style.display="none",me.style.display="none")},ft=function(){var e=l.getDuration()-b.getRemainingTime();0<(M=Math.ceil(l.getSkipTimeOffset()-e))?ge.innerText="Skip ad in "+M:(v.style.display="block",A.style.display="none",clearInterval(d))},At=function(){var e=b.getRemainingTime(),t=(Pe||o<e&&(o=e,Pe=!0),(o-e)/o);ce.innerHTML=ht(e),re.clientWidth<50||isNaN(t)||(ue.style.width=100*t+"%")},ht=function(e){(e=Math.round(e))<0&&(e=0);var t=Math.floor(e/60%60),e=Math.floor(e%60);return[t,e=e<10?"0"+e:e].join(":")},Lt=function(){L.className="fadedIn",p.style.pointerEvents="auto",E.style.pointerEvents="auto",v.style.pointerEvents="auto",m.style.pointerEvents="auto"},Tt=function(){L.className="fadedOut",p.style.pointerEvents="none",E.style.pointerEvents="none",v.style.pointerEvents="none",m.style.pointerEvents="none"},bt=function(e){C||(C=!0,t=setTimeout(function(){C=!1},500),N?(D(p,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),b.resume(),s=setInterval(At,250),l.isSkippable&&0<M&&k&&(d=setInterval(ft,250))):(D(p,"ads_playButton","Play","31","31","0 0 44 44","play"),b.pause(),clearInterval(s),clearInterval(d)),N=!N)};return{pluginInitialisation:function(e){P("ad-plugin-init"),a=e.playerInterface,n={id:"dfpAds",version:"5.7.0"},i=a.datastore.get("plugins"),Le=i?((i=i.slice()).push(n),i):[n],a.datastore.set({name:"plugins",data:Le.slice()}),ee(),a.listenerObject={pluginLoaded:Fe};var t,n,i=(i=a.datastore.get("AdsPluginParameters"))||{};a.updateUiConfig({cta:{enabled:!1}}),e.loadCSS(i.cssPath||"../css/dfpAds.css"),he=!!i.pretendPlaylistHasAds,te=i.adTag,ne=!!i.debug,ie=a.settings.ui.colour,ae=a.settings.ui.foreColour,Te="function"==typeof i.setupCompanionAds?i.setupCompanionAds:function(){},F(),oe=setTimeout(function(){J()},5e3),t=X,P("ad-sdk-load"),window.google&&window.google.ima?t():((n=document.createElement("script")).async=!0,n.type="text/javascript",n.onload=function(){t()},n.src=document.location.protocol+(!0==ne?"//imasdk.googleapis.com/js/sdkloader/ima3_debug.js":"//imasdk.googleapis.com/js/sdkloader/ima3.js"),document.getElementsByTagName("head")[0].appendChild(n))},reset:function(){clearTimeout(t),clearTimeout(se),clearTimeout(oe),Ge()}}}();var runPlugin=function(e,t){return e.register({name:"dfpAds.js"}),AdsPlugin};